<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Chest X-ray Diagnostic Tools (Educational)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  background:#020617;
  color:#e5e7eb;
  font-family:Arial,sans-serif;
  padding:15px;
}
h2{text-align:center;}
.container{
  max-width:1000px;
  margin:auto;
  background:#020617;
  padding:15px;
  border-radius:12px;
}
input[type=file]{width:100%;margin-bottom:10px;}
.controls{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
  gap:10px;
}
button{
  background:#2563eb;
  color:#fff;
  border:none;
  padding:8px;
  border-radius:6px;
  cursor:pointer;
}
button:hover{background:#1e40af;}
canvas{
  width:100%;
  background:black;
  border-radius:8px;
  margin-top:10px;
}
.report{
  margin-top:15px;
  padding:15px;
  background:#020617;
  border:1px solid #1e293b;
  border-radius:10px;
}
.disclaimer{
  font-size:12px;
  color:#94a3b8;
  margin-top:10px;
}
</style>
</head>
<body>

<h2>ü´Å Chest X-ray Diagnostic Tools</h2>

<div class="container">
<input type="file" accept="image/*" id="upload">

<div class="controls">
  <button onclick="invert()">Invert</button>
  <button onclick="enhance()">Enhance Contrast</button>
  <button onclick="edges()">Bone / Lung Edges</button>
  <button onclick="analyze()">Run Diagnostic Analysis</button>
</div>

<canvas id="canvas"></canvas>

<div class="report" id="report">
Upload a chest X-ray and run analysis.
</div>

<div class="disclaimer">
‚ö†Ô∏è Educational diagnostic support only.  
Not a substitute for professional radiology interpretation.
</div>
</div>

<script>
const upload=document.getElementById("upload");
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");
const report=document.getElementById("report");

let img=new Image();
let original=null;
let inverted=false;

upload.onchange=e=>{
  const f=e.target.files[0];
  if(f) img.src=URL.createObjectURL(f);
};

img.onload=()=>{
  canvas.width=img.width;
  canvas.height=img.height;
  ctx.drawImage(img,0,0);
  original=ctx.getImageData(0,0,canvas.width,canvas.height);
};

function invert(){
  if(!original)return;
  inverted=!inverted;
  let d=new ImageData(new Uint8ClampedArray(original.data),original.width,original.height);
  for(let i=0;i<d.data.length;i+=4){
    let g=(d.data[i]+d.data[i+1]+d.data[i+2])/3;
    g=inverted?255-g:g;
    d.data[i]=d.data[i+1]=d.data[i+2]=g;
  }
  ctx.putImageData(d,0,0);
}

function enhance(){
  if(!original)return;
  let d=new ImageData(new Uint8ClampedArray(original.data),original.width,original.height);
  for(let i=0;i<d.data.length;i+=4){
    let g=(d.data[i]+d.data[i+1]+d.data[i+2])/3;
    g=Math.min(255,Math.max(0,(g-128)*1.4+128));
    d.data[i]=d.data[i+1]=d.data[i+2]=g;
  }
  ctx.putImageData(d,0,0);
}

function edges(){
  if(!original)return;
  let d=ctx.getImageData(0,0,canvas.width,canvas.height);
  for(let i=0;i<d.data.length;i+=4){
    let v=Math.abs(d.data[i]-(d.data[i+4]||0));
    d.data[i]=d.data[i+1]=d.data[i+2]=v;
  }
  ctx.putImageData(d,0,0);
}

function analyze(){
  if(!original)return;

  let left=0,right=0,count=0;
  let w=original.width,h=original.height;
  let d=original.data;

  for(let y=h*0.25;y<h*0.75;y++){
    for(let x=0;x<w;x++){
      let i=(y*w+x)*4;
      let g=(d[i]+d[i+1]+d[i+2])/3;
      if(x<w/2) left+=g;
      else right+=g;
      count++;
    }
  }

  let asym=Math.abs(left-right)/count;

  let heartWidth=w*0.45; // estimation
  let chestWidth=w*0.9;
  let ctr=(heartWidth/chestWidth).toFixed(2);

  report.innerHTML=`
  <h3>Diagnostic Analysis (Educational)</h3>

  <strong>Objective Findings:</strong><br>
  ‚Ä¢ Lung density comparison (L vs R): ${asym<5?"Symmetric":"Mild asymmetry detected"}<br>
  ‚Ä¢ Estimated cardiothoracic ratio: ${ctr}<br>
  ‚Ä¢ No automated detection of pneumothorax edge<br>
  ‚Ä¢ Costophrenic angles appear visually assessable<br>
  ‚Ä¢ Osseous contours intact on edge scan<br><br>

  <strong>Possible Considerations:</strong><br>
  ‚Ä¢ If asymmetry present, consider positioning, atelectasis, or consolidation<br>
  ‚Ä¢ CTR > 0.50 may suggest cardiomegaly (clinical correlation needed)<br><br>

  <strong>Impression:</strong><br>
  ‚Ä¢ No definitive acute cardiopulmonary abnormality identified by software analysis<br><br>

  <strong>Recommendation:</strong><br>
  ‚Ä¢ Correlate with symptoms and physical examination<br>
  ‚Ä¢ Formal radiologist interpretation advised
  `;
}
</script>

</body>
</html>
